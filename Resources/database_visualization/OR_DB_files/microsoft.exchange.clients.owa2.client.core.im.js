try { window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['microsoft.exchange.clients.owa2.client.core.im.js'] = (new Date()).getTime();
Type.registerNamespace("_im");_im.$1A6=function(n){_im.$1A6.initializeBase(this);this.$A4=n};_im.$1A6.prototype={$A4:null,$6OX:function(n){this.$A4.set_$1jv(1);n.$7Qe(this.$A4.get_$ju(),null,this.$$d_$6qk,this.$$d_$1N0)},$6vq:function(n,t,i){if(n===-9){_js.Trace.logInfo(_a.$0.$6z,"AcceptChatAction.ProcessResult: Suppressing 'ConversationEnded' error.");n=0}if(n<0){i(Error.create("InstantMessageOperationError: "+n));return}this.$A4.set_$1jv(3);_js.Trace.logInfo(_a.$0.$6z,"AcceptChatSession web service call succeeded for chat {0}.",this.$A4.get_$ju());t()},$XN:function(){_a.$Fj.prototype.$XN.call(this)}};_im.$102=function(n,t){this.$5a5=n;this.$61E=t};_im.$102.prototype={$61E:null,$5a5:null,$3kk:function(n,t){return this.$5a5.$3kk(n,t)},$4XW:function(n,t){return this.$5a5.$4XW(n,t)},$AR4:function(n,t){return new _im.$1PY(n,t)},$7gL:function(n){return this.$61E.$7gL(n)}};_im.$1Ec=function(n,t){_im.$1Ec.initializeBase(this);this.$A4=n;this.$6s=t};_im.$1Ec.prototype={$A4:null,$6s:null,$kB:function(){_a.$Fj.prototype.$kB.call(this);this.$6s.$E0m(this.$A4)},$6OX:function(n){if(this.$A4.get_$ju()===-1){this.$A4.set_$1jv(4);return}n.$9q9(this.$A4.get_$ju(),null,this.$$d_$6qk,this.$$d_$1N0)},$6vq:function(n,t,i){this.$A4.set_$1jv(4);if(!n){i(Error.create("EndChatAction returned false."));return}t()}};_im.$1Ed=function(n){this.$6s=n};_im.$1Ed.prototype={$6s:null,$7gL:function(n){return new _im.$1Ec(n,this.$6s)}};_im.$1HK=function(n){_im.$1HK.initializeBase(this);_a.$4.$1Z5(n,"sipUris");this.$1v7=n};_im.$1HK.prototype={$1v7:null,$6OX:function(n){n.$8Hh(this.$1v7,null,this.$$d_$6qk,this.$$d_$1N0)},$6vq:function(n,t,i){if(n<0){i(Error.create("GetPresenceAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$1JN=function(n){_im.$1JN.initializeBase(this);this.$3J0=n};_im.$1JN.prototype={$3J0:!1,$2Yy:!1,$6OX:function(n){n.$8Ql(this.$3J0,null,this.$$d_$6qk,this.$$d_$1N0)},$6vq:function(n,t,i){if(n<0){if(n!==-2){_js.Trace.logInfo(_a.$0.$6z,"Sign in failed with code {0}, will retry.",n);this.$2Yy=!0}i(Error.create("InstantMessageOperationError: "+n));return}t()}};_im.$13b=function(n){_im.$13b.initializeBase(this);this.$3J0=n};_im.$13b.prototype={$3J0:!1,$6OX:function(n){n.$8Qm(this.$3J0,null,this.$$d_$6qk,this.$$d_$1N0)},$6vq:function(n,t,i){if(n<0){i(Error.create("InstantMessageOperationError: "+n));return}t()}};_im.$1P0=function(){_im.$1P0.initializeBase(this)};_im.$1P0.prototype={$6OX:function(n){n.$3Vx(null,this.$$d_$6qk,this.$$d_$1N0)},$6vq:function(n,t,i){if(n<0){i(Error.create("ResetPresenceAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$1PY=function(n,t){_im.$1PY.initializeBase(this);this.$A4=n;this.$3V=t};_im.$1PY.prototype={$3V:null,$A4:null,$kB:function(){_a.$Fj.prototype.$kB.call(this)},$6OX:function(n){this.$A4.get_$1jv()||this.$A4.set_$1jv(1);var t=new _g.$Zz(this.$3V);t.ChatSessionId=this.$A4.get_$ju();t.Recipients=this.$A4.$BrJ();t.Subject=this.$A4.get_$3o();n.$73i(t,null,this.$$d_$6qk,this.$$d_$1N0)},$6vq:function(n,t,i){if(n<0){i(Error.create("InstantMessageOperationError: "+n));return}this.$A4.set_$ju(n);this.$A4.set_$1jv(3);t()},$XN:function(){$C(this.$2H.message)&&this.$A4.$x1(_nbs.NonBootStrings.l_IMDeliveryError_Text);_a.$Fj.prototype.$XN.call(this)}};_im.$1QM=function(n,t){_im.$1QM.initializeBase(this);_a.$4.$1s(n,"sipUri");this.$Sz=n;this.$46k=t};_im.$1QM.prototype={$Sz:null,$46k:"None",$6OX:function(n){var t=new _g.$dw;t.Presence=this.$46k;n.$7CW(t,null,this.$$d_$6qk,this.$$d_$1N0)},$6vq:function(n,t,i){var r=n;if(r){i(Error.create("SetPresenceAction failed with InstantMessageOperationError: "+r));return}t()}};_im.$Y0=function(n,t,i,r,u){_im.$Y0.initializeBase(this);_a.$4.$X(i,"participants");_a.$4.$1BF(i.get_$A(),0,"participants.Count");if(!$C(u)){if(i.get_$A()!==1)throw Error.invalidOperation("imAddress can only be used in conjunction with a single participant.");if(!$C(r))throw Error.invalidOperation("imAddress and itemOrConversation are mutually exclusive.");}this.$6s=n;this.$1NC=this.$7gT(i);_a.$4.$1BF(this.$1NC.get_$A(),0,"No valid participants.");this.$2ZX=t;this.$3KS=r;this.$1Tf=u};_im.$Y0.prototype={$6s:null,$2ZX:null,$1NC:null,$3KS:null,$1Tf:null,$kB:function(){_a.$Fj.prototype.$kB.call(this);if(!$C(this.$2ZX)){this.$2ZX.$9nR(this.$1NC,this.$3KS,this.$1Tf);return}this.$6s.$9nR(this.$1NC,this.$3KS,this.$1Tf)},$98C:function(){return 0},$7gT:function(n){for(var u=new _js.$X,f={},e=n.get_$A(),i=0;i<e;i++){var t=n.get_$E(i);if(t&&this.$6s.$1jr(t.get_$DF())){var r=t.get_$DF();if(!(r in f)){u.$F(t);f[r]=t}}}return u}};_im.$18i=function(n,t){this.$6s=n;this.$2ZX=t};_im.$18i.prototype={$6s:null,$2ZX:null,$3kk:function(n,t){return new _im.$Y0(this.$6s,this.$2ZX,n,t,null)},$4XW:function(n,t){var i=new _js.$X;i.$F(n);return new _im.$Y0(this.$6s,this.$2ZX,i,null,t)}};_im.$1R9=function(n){_im.$1R9.initializeBase(this);_a.$4.$1Z5(n,"sipUris");this.$1v7=n};_im.$1R9.prototype={$1v7:null,$6OX:function(n){n.$9oX(this.$1v7,null,this.$$d_$6qk,this.$$d_$1N0)},$6vq:function(n,t,i){if(n<0){i(Error.create("SubscribeForPresenceUpdatesAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$1TH=function(n){_im.$1TH.initializeBase(this);_a.$4.$1s(n,"sipUri");this.$Sz=n};_im.$1TH.prototype={$Sz:null,$6OX:function(n){n.$9tL(this.$Sz,null,this.$$d_$6qk,this.$$d_$1N0)},$6vq:function(n,t,i){if(n<0){i(Error.create("UnsubscribeFromPresenceUpdatesAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$1CO=function(n){this.$62b=n.get_$EpZ();this.$iy={}};_im.$1CO.prototype={$62b:0,$iy:null,$F:function(n){this.$7pZ();this.$iy[n.toString()]=this.$2k8()},$Hq:function(n){this.$7pZ();return n.toString()in this.$iy},$2k8:function(){return _a.$8.get_$38()},$7pZ:function(){var s=this.$2k8();var u=new(_ff.$18.$$(String));var f=this.$iy;for(var r in f){var i={key:r,value:f[r]};var h=i.value;var c=h.$1ws(this.$62b);c.$3t(s)<0&&u.$F(i.key)}for(var t=u.$3Q(),o=t.length,n=0;n<o;++n){var e=t[n];delete this.$iy[e]}}};_im.$4s=function(n,t,i,r,u,f,e){this.$$d_$9zA=Function.createDelegate(this,this.$9zA);this.$$d_$DkZ=Function.createDelegate(this,this.$DkZ);this.$$d_$Dka=Function.createDelegate(this,this.$Dka);this.$$d_$Daa=Function.createDelegate(this,this.$Daa);this.$$d_$EgM=Function.createDelegate(this,this.$EgM);this.$$d_$3vp=Function.createDelegate(this,this.$3vp);this.$$d_$DVH=Function.createDelegate(this,this.$DVH);this.$$d_$Dhx=Function.createDelegate(this,this.$Dhx);this.$$d_$Dhy=Function.createDelegate(this,this.$Dhy);this.$$d_$Dk2=Function.createDelegate(this,this.$Dk2);this.$$d_$Dk3=Function.createDelegate(this,this.$Dk3);this.$$d_$9Cl=Function.createDelegate(this,this.$9Cl);this.$$d_$9Cm=Function.createDelegate(this,this.$9Cm);this.$$d_$DQf=Function.createDelegate(this,this.$DQf);this.$$d_$5EJ=Function.createDelegate(this,this.$5EJ);this.$$d_$9oj=Function.createDelegate(this,this.$9oj);this.$1Zq=new _js.$X;this.$BB=new _js.$X;this.$gw=new _js.$X;_im.$4s.resolveInheritance();this.apcl=this.$p;this.rpcl=this.$1B;_im.$4s.initializeBase(this);this.$nJ("Initialization","unknown");this.$Yu=t;this.add_$2Us(this.$Yu.$$d_$9vh);if(!n){this.$nJ("Initialization","Disabled");return}this.$n=i;this.$28o=!0;this.$1gF=!1;this.$4rx=new _im.$1CO(_a.$D6.$AtG(30));var s=new _g.$98;s.NotificationType="InstantMessageNotification";this.$T1=new _h.$D5(s,this.$n,r);this.$T1.add_$3c7(this.$$d_$9oj);if(u&&e){this.$3Ho=!0;_js.Trace.logInfo(_a.$0.$6z,"ChatManager: Waiting for the pending-get activation event.");var o=this;u.$1k(_a.$S7,function(n){_js.Trace.logInfo(_a.$0.$6z,"ChatManager: Pending-get activated.");o.$1WQ=!0;o.$5ZE()});var h=this;u.$1k(_a.$o9,function(){h.$7Qb()});u.$1k(_a.$Lt,this.$$d_$5EJ);f?this.$3e(f):this.$Wj="Disabled"}this.$1Zq.add_$22(this.$$d_$DQf);this.$3U1=this.$AQ6(this.$n)};_im.$4s.$9sC=function(n,t,i){var r;var f,u;if(u=n.$3da(function(n){return n.get_$ju()===t},f={val:r}),r=f.val,u){i.val=r;return!0}i.val=null;return!1};_im.$4s.$Eqo=function(n,t,i){var r;var f,u;var e=(u=n.$3da(function(n){var i=n;if(i.get_$g6().get_$A()!==1)return!1;var r=i.get_$g6().get_$E(0);return r.get_$DF()===t?!0:!1},f={val:r}),r=f.val,u);i.val=r;return e};_im.$4s.prototype={$Yu:null,$3Ho:!1,$3lI:null,$1yo:null,$1WQ:!1,$2FU:!1,$6Pj:!1,$4rx:null,$n:null,$4Da:!1,$28o:!1,$2yS:!1,$Wj:"unknown",$2ZI:null,$1gF:!1,$T1:null,$3U1:null,add_$2Us:function(n){this.$32(_im.$4s.$27x,n)},remove_$2Us:function(n){this.$5d(_im.$4s.$27x,n)},get_$4I5:function(){return this.$Wj},get_$vT:function(){return this.$Wj==="SignedIn"},get_$2t:function(){this.$4Rm("IsEnabled");return this.$Wj!=="Disabled"},get_$9zg:function(){return this.$1Zq},get_$3vx:function(){return this.$BB},get_$5oL:function(){return this.$gw},get_$C9l:function(){return this.$6Pj},get_$2GH:function(){this.$4Rm("CurrentUserSipUri");return this.$1yo},$5ZC:function(n){if(!this.$1WQ){_js.Trace.logInfo(_a.$0.$6z,"Ignoring a SignIn attempt because the pending-get connection is not yet started.");return}this.$28o=!0;this.$1gF=n;this.$3vp()},$5ZG:function(n){_js.Trace.logInfo(_a.$0.$6z,"Signing out.");var t=new _im.$13b(n);t.add_$2s(this.$$d_$9Cm);t.add_$2b(this.$$d_$9Cl);this.$nJ("SignOut:Manual="+n,"AttemptingSignOut");this.$n.$1V(t)},$2be:function(n,t,i){var f=_im.$4h.$fG(t);var e;var r,u;var o=(u=this.$Yu.$5dq(f,r={val:e}),e=r.val,u);this.$63Y(n,f,_im.$4h.$2LN(i),o)},$Ekx:function(n,t){var i=new _im.$1QM(_im.$4h.$fG(n),t);i.add_$2s(this.$$d_$Dk3);i.add_$2b(this.$$d_$Dk2);this.$n.$1V(i)},$nJ:function(n,t){t==="Error";_js.Trace.logInfo(_a.$0.$6z,"SignInState: {0} Requesting change from {1} to {2}",n,this.$Wj,t);var i=this.get_$vT();if(this.$Wj!==t){this.$Wj=t;this.$4(_im.$4s.$2ZK);this.get_$vT()!==i&&this.$4(_im.$4s.$4yT)}},$7Mi:function(n,t){_js.Trace.logInfo(_a.$0.$6z,"Setting current user SIP URI to {0}",t);this.$1yo=t},$3Vx:function(){if(this.$Wj==="SignedIn"){_js.Trace.logInfo(_a.$0.$6z,"ResetPresence");var n=new _im.$1P0;n.add_$2s(this.$$d_$Dhy);n.add_$2b(this.$$d_$Dhx);this.$n.$1V(n)}},$9nR:function(n,t,i){_js.Trace.logInfo(_a.$0.$6z,"Starting chat.");_a.$4.$z(n,"basePersonaParticipants");_a.$4.$1BF(n.get_$A(),0,"basePersonaParticipants.Count");$C(i)||_a.$4.$S5(n.get_$A(),1,"When imAddress is specified, participant count must be 1.");for(var u=new _js.$X,w=n.get_$A(),o=0;o<w;o++){var y=n.get_$E(o);var p=_pc.$q.$2Fp(y);u.$F(p)}var r=null;if(u.get_$A()===1){var e=u.get_$E(0);var f=null;$C(i)?$C(e.get_$DF())||(f=e.get_$DF()):f=i;if(!$C(f)){var h,s;s=_im.$4s.$Eqo(this.$1Zq,f,h={val:r}),r=h.val,s}var c=e.get_$26();if(!_js.$9.$1h(f)&&!_js.$9.$1h(c)){var v=_im.$4h.$fG(f);this.$Yu.$2W("StartChat (single participant)",v,c,e.$Hg,!0)}}else{var l=this;u.$Cj(function(n){var t=n;var r=t.get_$DF();var i=t.get_$26();if(!_js.$9.$1h(r)&&!_js.$9.$1h(i)){var u=_im.$4h.$fG(r);l.$Yu.$2W("StartChat (multiple participants)",u,i,t.$Hg,!0)}})}if(!r){r=this.$7fu(u,t);this.$7Qq(r);if(!$C(i)){var a=u.get_$E(0);r.$EWV(a,i)}}_g.$11.isInstanceOfType(t)?r.set_$8bk(t):_g.$6W.isInstanceOfType(t)&&r.set_$8bg(t);return r},$3fa:function(n){_js.Trace.logInfo(_a.$0.$6z,"Accepting invitation.");this.$BB.$3M(n);this.$7Qq(n);var t=new _im.$1A6(n);this.$n.$1V(t)},$3uz:function(n){_js.Trace.logInfo(_a.$0.$6z,"Ignoring invitation.");this.$BB.$3M(n);this.$4rx.$F(n.get_$ju())},$9zF:function(n){_js.Trace.logInfo(_a.$0.$1Pz,"Accepting buddy request {0} ",n.get_$2Z());var u=this.$gw.$3M(n);var r=this.$4ns(n);var t=new _g.$W7;t.GroupType="OtherContacts";var i=new _c.$1A5(r,t);this.$n.$1V(i)},$ATd:function(n){_js.Trace.logInfo(_a.$0.$1Pz,"Ignoring buddy request {0} ",n.get_$2Z());this.$gw.$3M(n);var i=this.$4ns(n);var t=new _c.$1De(i);this.$n.$1V(t)},$E0m:function(n){_js.Trace.logInfo(_a.$0.$6z,"Removing chat {0}",n.get_$ju());n.set_$1jv(4);n.get_$g6().remove_$22(this.$$d_$DVH);var i=this.$1Zq.$3M(n);var t=this.$BB.$3M(n);$C(n.get_$2O())||_h.$o.get_$Q().$sl(n.get_$2O().Id)},$Daa:function(n){if(n.EventType==="Reload"){_js.Trace.logWarning(_a.$0.$6z,"ChatManager.OnIMNotification: Received a 'Reload' notification from the OWA server, assuming server has rebooted or connection re-established");this.$28o=!0;this.$3aH(!1);return}var t=n;var i=t.PayloadType;if($C(i)){_js.Trace.logWarning(_a.$0.$6z,"ChatManager.OnIMNotification: Unexpected notification payload: {0}, {1}",n.EventType,n.toString());return}if(i==="ServiceUnavailable"){if(t.ServiceError==="ClientSignOut"){_js.Trace.logWarning(_a.$0.$6z,"ChatManager.OnIMNotification: Service unavailable, client signed out.  {0}",t.ErrorMessage);this.$nJ("IMNotification","SignedOut");return}_js.Trace.logWarning(_a.$0.$6z,"ChatManager.OnIMNotification: Received a 'ServiceUnavailable' notification: {0}, {1}.",t.ServiceError,t.ErrorMessage);this.$3aH(!1);return}if(i==="SignOn")if(t.SignOnStarted){_js.Trace.logInfo(_a.$0.$6z,"ChatManager.OnIMNotification: Sign-on started.");return}else{_js.Trace.logInfo(_a.$0.$6z,"ChatManager.OnIMNotification: Sign-on succeeded.");this.$3aH(!0);this.$6qO();this.$6Pj=t.IsUserInUcsMode;return}if(i==="UpdateUserPresence"||i==="UserPresenceChange"||i==="QueryUserPresenceChange"){this.$Aqw(t);return}this.$Yu.$7MW(t);!$C(t.Persona)&&$C(t.Persona.ImAddress)&&(t.Persona.ImAddress=t.SipUri);if(t.PayloadType==="PendingContactList"){if($C(t.PendingContacts)){_js.Trace.logWarning(_a.$0.$1Pz,"The payload for PendingContacts is empty");return}this.$ALc(t.PendingContacts);return}if(t.PayloadType==="AddToBuddyList"){if($C(t.AddedContacts)){_js.Trace.logWarning(_a.$0.$1Pz,"The payload for AddedContacts is empty");return}this.$E0j(t.AddedContacts)&&_js.Trace.logInfo(_a.$0.$1Pz,"Removed already added contact from pending buddyRequests");return}if(t.PayloadType==="EmptySubscribers"){this.$Alw();_js.Trace.logInfo(_a.$0.$1Pz,"Removed already added contact from pending buddyRequests after receiving emptysubscribers");return}if(!("ChatSessionId"in t)){_js.Trace.logInfo(_a.$0.$6z,"Notification {0} not supported, no session id.",i);return}if(this.$4rx.$Hq(t.ChatSessionId)){_js.Trace.logInfo(_a.$0.$6z,"ChatManager.OnIMNotification: {0} for conversation {1} was ignored.",t.PayloadType,t.ChatSessionId);return}_js.Trace.logInfo(_a.$0.$6z,"ChatManager.OnIMNotification: {0}, Session={1}, SipUri={2}",i,t.ChatSessionId,t.SipUri);var r;var e,o,u,f;if((o=_im.$4s.$9sC(this.$1Zq,t.ChatSessionId,e={val:r}),r=e.val,o)||(f=_im.$4s.$9sC(this.$BB,t.ChatSessionId,u={val:r}),r=u.val,f)){var s=this.$Yu.$3Et(t.SipUri,t.DisplayName);this.$DuS(t,r,s);return}_js.Trace.logInfo(_a.$0.$6z,"No matching chat found for session {0}",t.ChatSessionId);this.$ErC(t)},$4Uj:function(n){for(var r=n.get_$A(),t=0;t<r;t++){var i=n.get_$E(t);if(i&&this.$1jr(i.SipUri))return!0}return!1},$1jr:function(n){return _js.$9.$1h(n)?!1:_js.$9.$1h(this.get_$2GH())?!1:n.toLowerCase()===this.get_$2GH().toLowerCase()?!1:!0},$2LN:function(n){return _im.$4h.$2LN(n)},$6J0:function(n){return _im.$4h.$6J0(n)},$AQ6:function(n){return new _im.$1O9(n)},$AUD:function(){this.$nJ("DelayInternalSignIn","AttemptingSignIn");_js.$D.get_$Q().$2V(_a.$0.$6z,"ChatManager.InternalSignIn",this.$$d_$3vp,3e4)},$2A:function(){this.remove_$2Us(this.$Yu.$$d_$9vh);_js.$Ec.prototype.$2A.call(this)},$Dka:function(n){_js.Trace.logInfo(_a.$0.$6z,"Sign-in action succeeded.  Awaiting notification.");this.$2ZI=_js.$D.get_$Q().$2V(_a.$0.$6z,"ChatManager.SignInNotificationTimeout",this.$$d_$EgM,1e4)},$DkZ:function(n){_js.Trace.logInfo(_a.$0.$6z,"Sign-in action failed.");var t=n;if(t.get_$4d()===-11){_js.Trace.logInfo(_a.$0.$6z,"Automatic sign-in rejected because the user was explicitly signed out.");this.$nJ("Automatic Sign-In Rejected","SignedOut");return}_js.Trace.logWarning(_a.$0.$6z,"Sign-in failed: {0}",t.$2H.message);this.$3aH(!1)},$EgM:function(){_js.Trace.logWarning(_a.$0.$6z,"Sign-in timeout expired.  Current sign-in state: {0}, ServiceAvailable: {1}.",this.$Wj,this.$4Da);this.$Wj!=="SignedIn"&&this.$3aH(!1)},$9Cm:function(n){_js.Trace.logInfo(_a.$0.$6z,"Sign-out succeeded.");this.$nJ("SignOutSucceeded","SignedOut")},$9oj:function(n,t){if(!this.$2yS){_js.Trace.logInfo(_a.$0.$6z,"Subscribed to notifications.");this.$2yS=!0;this.$3vp()}},$8RX:function(n,t,i){if(this.$Wj!=="Disabled"){var r=n?"SignedOut":"Disabled";if(_js.$9.$o(i)){_js.Trace.logInfo(_a.$0.$6z,"The currentUserSipUri is null/empty -> Marking SignInState as disabled.");r="Disabled"}else i=_im.$4h.$fG(i);this.$nJ("Configuration Updated",r)}this.$3lI=t;this.$7Mi("InternalSetConfiguration",i);this.$2FU=!0},$3vp:function(){if(!this.$2yS){_js.Trace.logInfo(_a.$0.$6z,"Subscribing to notifications.");this.$T1.$1k(_a.$0.$6z,"OnIMNotification",this.$$d_$Daa,1);return}_js.Trace.logInfo(_a.$0.$6z,"Signing in. Manual: {0}, will retry: {1}",this.$1gF,this.$28o);var n=new _im.$1JN(this.$1gF);n.add_$2s(this.$$d_$Dka);n.add_$2b(this.$$d_$DkZ);this.$nJ("InternalSignIn","AttemptingSignIn");this.$n.$1V(n);this.$2ZI&&(this.$2ZI=_js.$D.get_$Q().$6Q(this.$2ZI))},$4ns:function(n){var t=new _g.$W6;_a.$4.$z(n,"persona");t.DisplayName=n.get_$26();t.SipUri=n.get_$DF();return t},$7fu:function(n,t){_js.Trace.logInfo(_a.$0.$6z,"Creating new Chat.");var i=new _h.$1g(!0);i.get_$g6().add_$22(this.$$d_$DVH);i.get_$g6().$1yS(n);i.set_$2O(new _g.$1T("IM:"+Math.random().toString()));if(!t)return i;if(_g.$11.isInstanceOfType(t)){i.set_$8bk(t);return i}if(_g.$6W.isInstanceOfType(t)){i.set_$8bg(t);return i}var r=_js.$9.$5K("CreateChat: itemOrConversation type {0} is not supported.",Object.getType(t).getName());_js.Trace.logError(_a.$0.$6z,r);throw Error.invalidOperation(r);},$7Qq:function(n){_js.Trace.logInfo(_a.$0.$6z,"Activating chat.");$C(n.get_$2O())||_h.$o.get_$Q().$JZ(n.get_$2O().Id,n);var t=this.$BoZ(n);this.$1Zq.$6i(t,n)},$DuS:function(n,t,i){var u=n.PayloadType;switch(u){case"NewChatMessageToast":_js.Trace.logInfo(_a.$0.$6z,"NewChatMessageToast received and mapped to chat {0}.",t.get_$ju());return;case"ParticipantJoined":this.$Yu.$7TI(n);var r;if($C(n.Persona))r=_pc.$q.$4Xq(i,n.SipUri);else{r=new _pc.$q;r.$KH(n.Persona)}t.$DpJ(n.SipUri,r,i);return;case"ParticipantLeft":t.$DpK(n.SipUri,i);return;case"EndChatSession":t.$6Kn||this.$BB.$3M(t);return;case"NewChatMessage":t.$9Ai(i,n.MessageContent);return;case"UserActivity":switch(n.UserActivity){case"FailedDelivery":t.$x1(_nbs.NonBootStrings.l_IMDeliveryError_Text);return;case"Typing":t.$Eg1(i);return;case"StoppedTyping":t.set_$GZ("");return;case"TwoOrMoreTyping":t.set_$GZ(_nbs.NonBootStrings.l_IMActivityMultipleUsersTyping_Text);return;case"DeliveryTimeout":t.$x1(_nbs.NonBootStrings.l_IMDeliveryTimeout_Text);return;default:return}}},$ErC:function(n){if(n.PayloadType==="NewChatMessageToast"){this.$Yu.$7TI(n);var r=this.$Yu.$3Et(n.SipUri,n.DisplayName);var u=this.$7h7(n.Persona,r,n.SipUri,n.ToastMessage,n.MessageSubject,n.ChatSessionId);_js.Trace.logInfo(_a.$0.$6z,"ChatManager.TryProcessInvitation: Created invitation for conversation {0} (NewChatMessageToast).",n.ChatSessionId);return!0}if(n.PayloadType==="NewChatMessage"){var t=this.$Yu.$3Et(n.SipUri,n.DisplayName);var i=this.$7h7(n.Persona,t,n.SipUri,n.MessageContent,"",n.ChatSessionId);i.$9Ai(t,n.MessageContent);_js.Trace.logInfo(_a.$0.$6z,"ChatManager.TryProcessInvitation: Created invitation for conversation {0} (NewChatMessage).",n.ChatSessionId);return!0}return!1},$7h7:function(n,t,i,r,u,f){var o;if($C(n))o=_pc.$q.$4Xq(t,i);else{o=new _pc.$q;o.$KH(n)}$C(r)&&(r="");var s=new _js.$X;s.$F(o);var e=this.$7fu(s,null);e.set_$ju(f);e.$2ag=o;e.$3d4=r;_js.$9.$1h(u)||e.set_$3o(u);this.$BB.$F(e);return e},$ALc:function(n){_a.$4.$z(n,"senderInfo");for(var u=n,e=u.length,r=0;r<e;++r){var t=u[r];var i=t.SipUri;_js.Trace.logInfo(_a.$0.$1Pz,"Adding pending contact to buddy requests list",i);var f=this.$3Eu(t.DisplayName,t.Title,i);this.$8Ty(i,!1)||this.$gw.$F(f)}},$E0j:function(n){_a.$4.$z(n,"senderInfo");for(var r=!1,u=n,f=u.length,t=0;t<f;++t){var e=u[t];var i=e.SipUri;_js.Trace.logInfo(_a.$0.$1Pz,"Examining the AddToBuddyList payload for existing buddy requests",i);r=this.$8Ty(i,!0)}return r},$Alw:function(){_js.Trace.logInfo(_a.$0.$1Pz,"Received empty subscribers notification, we need to hide the pending buddy dialogue");this.$gw.$1u()},$3Eu:function(n,t,i){_a.$4.$z(n,"displayName");_a.$4.$z(i,"buddyImAddress");var r=_pc.$q.$4Xq(n,i);_js.$9.$o(t)||r.set_$3u(t);return r},$8Ty:function(n,t){for(var i=0;i<this.$gw.get_$A();i++){var r=this.$gw.get_$E(i);if(!r.get_$DF().localeCompare(n)){if(t){_js.Trace.logInfo(_a.$0.$1Pz,"Removing already added contact from pending buddyRequests",r.get_$DF());this.$gw.$5W(i)}return!0}}return!1},$BoZ:function(n){var t=this;return this.$1Zq.$HE(function(t){return n.$40C.$3t(t.$40C)>=0})},$3aH:function(n){this.$2ZI&&(this.$2ZI=_js.$D.get_$Q().$6Q(this.$2ZI));var t=this.$4Da;this.$4Da=n;if(n&&t){_js.Trace.logInfo(_a.$0.$6z,"Service confirmed available.");return}else if(n&&!t){_js.Trace.logInfo(_a.$0.$6z,"Service resumed.");return}else if(!n&&t){_js.Trace.logInfo(_a.$0.$6z,"Service interrupted.");this.$7Qb();this.$9PU();return}else if(!n&&!t){_js.Trace.logInfo(_a.$0.$6z,"Service confirmed unavailable.");this.$9PU();return}_js.Trace.logError(_a.$0.$6z,"Unexpected condition in ChatManager.SetServiceAvailability.")},$6qO:function(){this.$nJ("SignedOn Succeeded","SignedIn");this.$28o=!0;this.$1gF=!1},$7Qb:function(){this.$1Zq.$Cj(this.$$d_$9zA);this.$BB.$Cj(this.$$d_$9zA);var n=this;this.$1Zq.$Cj(function(t){t.$Efi(n.$4Da)})},$9PU:function(){if(this.$Wj==="AttemptingSignIn"||this.$Wj==="SignedIn"||this.$Wj==="Error"){if(this.$28o){this.$28o=!1;this.$AUD();return}this.$1gF=!1;this.$nJ("SignIn-GiveUp","Error")}},$9Cl:function(n){_js.Trace.logWarning(_a.$0.$6z,"Sign-out failed: {0}",n.$2H.message);this.$nJ("SignOutFailed","SignedOut")},$Dhy:function(n){_js.Trace.logInfo(_a.$0.$6z,"Reset presence succeeded.")},$Dhx:function(n){_js.Trace.logWarning(_a.$0.$6z,"Reset presence failed: {1}",n.$2H.message)},$Dk3:function(n){var t=n;_js.Trace.logInfo(_a.$0.$6z,"Set presence to {0} succeeded.",t.$46k)},$Dk2:function(n){var t=n;_js.Trace.logWarning(_a.$0.$6z,"Set presence to {0} failed: {1}",t.$46k,n.$2H.message)},$9zA:function(n){var t=n;t.set_$ju(-2);t.$Efj()},$63Y:function(n,t,i,r){var f=this.$Yu.$3Et(t,null);var e=new _im.$oi(n,t,f,i,r);var u=this.$v6(_im.$4s.$27x);u&&u(e)},$Aqw:function(n){var u=this.$v6(_im.$4s.$27x);if(u){var e=n.PayloadType;if(n.PayloadType==="UpdateUserPresence"){var r=n.DisplayName;_js.$9.$1h(r)&&(r=this.$3lI);var s=new _im.$oi(e,this.$1yo,r,_im.$4h.$2LN(n.NewUserPresence),!0);u(s);return}if(!$C(n.UserPresenceChanges))for(var h=n.PayloadType!=="QueryUserPresenceChange",f=n.UserPresenceChanges,c=f.length,i=0;i<c;++i){var t=f[i];var o=new _im.$oi(e,t.SipUri,t.UserName,_im.$4h.$2LN(t.Presence),h);u(o)}}},$DVH:function(n,t){switch(t.$3R){case 0:var f=t.$4C;var e=this.$8Cr(f);this.$3U1.$7UA(e);break;case 2:var u=t.$4X;var i=this.$8Cr(u);var r=this.$7qC(i);this.$3U1.$2Vm(r);break;case 1:case 3:default:_a.$4.$FY(!1,"Unexpected notification received: "+t.$3R);break}},$8Cr:function(n){var r=new(_ff.$18.$$(String));if(n)for(var i=n,f=i.length,t=0;t<f;++t){var u=i[t];this.$7TB(r,u)}return r},$7qC:function(n){for(var f=this.$6FV(this.$1Zq.$3Q()),u=new(_ff.$18.$$(String)),r=n.get_$1y(),e=r.length,t=0;t<e;++t){var i=r[t];f.$5l(i)||u.$F(i)}return u},$DQf:function(n,t){switch(t.$3R){case 0:var f=t.$4C;var e=this.$6FV(f);this.$3U1.$7UA(e);break;case 2:var u=t.$4X;var i=this.$6FV(u);var r=this.$7qC(i);this.$3U1.$2Vm(r);break;case 1:case 3:default:_a.$4.$FY(!1,"Unexpected notification received: "+t.$3R);break}},$6FV:function(n){var r=new(_ff.$18.$$(String));if(n)for(var u=n,e=u.length,t=0;t<e;++t){var o=u[t];var i=o;if(i.get_$g6()){var f=this;i.get_$g6().$Cj(function(n){f.$7TB(r,n)})}}return r},$7TB:function(n,t){var r=t;var i=_im.$4h.$fG(r.get_$DF());i.localeCompare(this.$1yo)&&(n.$5l(i)||n.$F(i))},$4Rm:function(n){this.$3Ho&&(this.$Wj==="unknown"||!this.$2FU)&&_js.Trace.logError(_a.$0.$6z,"ChatManager: Do not access {0} until configuration has loaded.",n)},$5ZE:function(){if(this.get_$2t()&&this.$1WQ&&this.$2FU){var n=this;_js.$D.get_$Q().$2V(_a.$0.$6z,"ChatManager.SignIn",function(){n.$5ZC(!1)},5e3)}},$3e:function(n){var r=n.get_$9N().get_$3vk();var i=n.get_$4P().get_$Lk();var t=n.get_$4P().get_$1wF();this.$8RX(r,i,t);this.$5ZE()},$5EJ:function(n){if(!n.$1Qc){this.$28o=!1;this.$3aH(!1)}}};_im.$103=function(n,t,i,r,u,f,e){this.$43=n;this.$Yu=t;this.$n=i;this.$2yP=r;this.$N=u;this.$d=f;this.$1og=e};_im.$103.prototype={$43:!1,$Yu:null,$n:null,$2yP:null,$N:null,$d:null,$1og:!1,$6s:null,$9:function(){this.$6s||(this.$6s=new _im.$4s(this.$43,this.$Yu,this.$n,this.$2yP,this.$N,this.$d.get_$1Z(),this.$1og));return this.$6s}};_im.$Lm=function(){this.$$d_$9vh=Function.createDelegate(this,this.$9vh);_im.$Lm.initializeBase(this);this.$Fx={}};_im.$Lm.prototype={$Fx:null,$3Vx:function(){var t=this.$Fx;for(var n in t){var r={key:n,value:t[n]};var i=r.value;i.set_$I2(0)}},$7MW:function(n){this.$9vg(n,!1)},$7TI:function(n){this.$9vg(n,!0)},$9vh:function(n){this.$2W(n.$2k,n.$Sz,n.$6u,n.$Hg,n.$2NM)},$2W:function(n,t,i,r,u){this.$5et(n,t,i,u);this.$2be(n,t,r,u)},$3Et:function(n,t){var i=t;if(_js.$9.$1h(i)&&!_js.$9.$1h(n)){n=_im.$4h.$fG(n);var r=this.$Fx[n];$C(r)||(i=r.$6u);_js.$9.$1h(i)&&(i=_im.$4h.$z2(n))}return i},$5dq:function(n,t){t.val=0;n=_im.$4h.$fG(n);var i=this.$Fx[n];if($C(i))return!1;t.val=i.$Hg;return!0},$9vg:function(n,t){if(!_js.$9.$1h(n.SipUri)){this.$5et(n.PayloadType,n.SipUri,n.DisplayName,t);if(!$C(n.NewUserPresence)){var i=_im.$4h.$2LN(n.NewUserPresence);this.$2be(n.PayloadType,n.SipUri,i,t)}}},$5et:function(n,t,i,r){var u=this;this.$5fD(n,t,r,function(n){_js.$9.$1h(i)||n.set_$26(i)})},$2be:function(n,t,i,r){var u=this;this.$5fD(n,t,r,function(n){$C(i)||n.set_$I2(i)})},$5fD:function(n,t,i,r){t=_im.$4h.$fG(t);var u=this.$Fx[t];if($C(u)){if(!i)return;u=new _im.$104(t);this.$Fx[t]=u}r(u)}};_im.$104=function(n){_im.$104.initializeBase(this);_a.$4.$1s(n,"sipUri");this.$Sz=n};_im.$104.prototype={$Sz:null,$6u:null,$Hg:0,set_$26:function(n){if(this.$6u===n)return n;this.$6u=n;this.$4("DisplayName");return n},set_$I2:function(n){if(this.$Hg===n)return n;this.$Hg=n;this.$4("Presence");return n},toString:function(){return String.format("SipUri: {0}, DisplayName: {1}, Presence: {2}",this.$Sz,$C(this.$6u)?"":this.$6u,this.$Hg)}};_im.$105=function(n,t,i,r){this.$$d_$DcP=Function.createDelegate(this,this.$DcP);this.$hc=n;this.$6s=t;this.$14h=i;this.$11s=r;this.$14h.add_$19s(this.$$d_$DcP);this.$11s.add_$19s(this.$$d_$DcP)};_im.$105.prototype={$6s:null,$14h:null,$11s:null,$hc:!1,$6v:null,$2m5:!1,$6Wr:0,add_$wI:function(n){if(n&&this.$hc){if(this.get_$G8()){n();return}this.$6v||(this.$6v=new Sys.EventHandlerList);this.$6v.addHandler("chatInitialized",n)}},get_$H3:function(){return this.get_$G8()&&this.$hc?this.$6s:null},get_$27w:function(){return this.get_$G8()&&this.$hc?this.$14h.get_$1Z():null},get_$1QI:function(){return this.get_$G8()&&this.$hc?this.$11s.get_$1Z():null},get_$rz:function(){return this.$hc},get_$G8:function(){if(!this.$2m5&&this.$hc){this.$14h.$9(null);this.$11s.$9(null)}return this.$2m5||!this.$hc},$DcP:function(){this.$6Wr++;if(this.$6Wr===2){this.$2m5=!0;if(this.$6v){this.$6v.getHandler("chatInitialized")();this.$6v=null}}}};_im.$106=function(n,t,i,r,u){this.$hc=n;this.$6s=t;this.$14h=i;this.$11s=r;this.$BR=u};_im.$106.prototype={$hc:!1,$6s:null,$14h:null,$11s:null,$BR:0,$1Q:null,$9:function(){_a.$4.$S5(this.$BR,"Mouse","ChatProviderFactory.Create - Layout");this.$1Q||(this.$1Q=new _im.$105(this.$hc,this.$6s,this.$14h,this.$11s));return this.$1Q}};_im.$16m=function(n,t,i){_im.$16m.initializeBase(this,[n,t,i]);_js.Trace.logInfo(_a.$0.$6z,"PopOutPresenceManager.Ctor.")};_im.$16m.prototype={get_isPopout:function(){return!0},$AQ5:function(){return new _im.$1Nz(this.$1Wh)},$5FR:function(n){this.$7Lf(n.$Sz,n.$Hg)},$7NB:function(n){this.$2W1.$7TJ(n)},$ExL:function(){}};_im.$1Nz=function(n){_im.$1Nz.initializeBase(this,[n]);_js.Trace.logInfo(_a.$0.$6z,"PopOutPresenceRequestsManager.Ctor")};_im.$1Nz.prototype={$7TJ:function(n){_a.$4.$1s(n,"sipUri");this.$1Wh.queryPresenceInMainWindow(n)},$E26:function(n){_a.$4.$1s(n,"sipUri");return!0},$AG3:function(){}};_im.$oh=function(n,t,i){this.$$d_$99G=Function.createDelegate(this,this.$99G);this.$$d_$5FR=Function.createDelegate(this,this.$5FR);this.$$d_$9Ck=Function.createDelegate(this,this.$9Ck);this.$b9={};_im.$oh.initializeBase(this);_a.$4.$X(n,"chatManager");_a.$4.$X(t,"chatParticipantCache");_a.$4.$X(i,"presenceCrossWindowNotifier");this.$6s=n;this.$Fx=t;this.$6s.$p(_im.$4s.$2ZK,this.$$d_$9Ck);this.$6s.add_$2Us(this.$$d_$5FR);this.$1Wh=i;this.$2W1=this.$AQ5();this.$2nZ=this.$6s.$Wj;_js.Trace.logInfo(_a.$0.$I2,"PresenceManager.Ctor.")};_im.$oh.prototype={$6s:null,$Fx:null,$1Wh:null,$2W1:null,$2nZ:"unknown",get_$vT:function(){return this.$6s.$Wj==="SignedIn"},$7LZ:function(n){_a.$4.$X(n,"persona");if(!this.$6s.get_$2t())return!1;_js.Trace.logInfo(_a.$0.$I2,"PresenceManager.TryRegisterForPresenceUpdates: Registering persona for presence updates: {0}, SIP:{1}",n.get_$B6(),n.get_$DF()||"");n.apcl("ImAddress",this.$$d_$99G);if(_js.$9.$1h(n.get_$DF()))return!0;var t=_im.$4h.$fG(n.get_$DF());this.$Eww(t,n);this.$7NB(t);return!0},$7Le:function(n){_a.$4.$X(n,"persona");_js.Trace.logInfo(_a.$0.$I2,"PresenceManager.TryUnregisterForPresenceUpdates: Unregistering persona for presence updates: {0}, SIP:{1}",n.get_$B6(),n.get_$DF()||"");return this.$5dy(n,n.get_$DF())},$Dw8:function(n,t){_a.$4.$1s(n,"sipUri");this.$7NB(n);t.val=0;if(n in this.$b9){var i=this.$b9[n];if(i.get_$A()>0){t.val=i.get_$E(0).get_$I2();return!0}}return!1},$AQ5:function(){return new _im.$SL(this.$1Wh)},$7NB:function(n){if(this.get_$vT()){var t;var r,i;(i=this.$Fx.$5dq(n,r={val:t}),t=r.val,i)&&this.$7Lf(n,t);n!==_im.$4h.$fG(this.$6s.get_$2GH())&&this.$2W1.$7TJ(n)}},$5FR:function(n){if(this.get_$vT()){this.$7Lf(n.$Sz,n.$Hg);this.$1Wh.updatePresenceInAllPopOutWindows(n.$Sz,n.$Hg)}},$7Lf:function(n,t){n=_im.$4h.$fG(n);if(!(n in this.$b9))return!1;for(var r=this.$b9[n],i=0;i<r.get_$A();i++){var u=r.get_$E(i);u.set_$I2(t)}return!0},$ExL:function(){this.$1Wh.updateSignInStateInAllPopOutWindows(this.$2nZ)},$2A:function(){_js.Trace.logInfo(_a.$0.$I2,"PresenceManager.InternalDispose.");this.$6s.$1B(_im.$4s.$2ZK,this.$$d_$9Ck);this.$6s.remove_$2Us(this.$$d_$5FR);this.$2W1.$1v();this.$2W1=null},$5dy:function(n,t){if(!this.$6s.get_$2t())return!1;n.rpcl("ImAddress",this.$$d_$99G);if(_js.$9.$1h(t))return!1;var i=_im.$4h.$fG(t);if(!(i in this.$b9))return!1;var r=this.$b9[i];var u=r.$3M(n);if(!r.get_$A()){delete this.$b9[i];this.$2W1.$E26(i)}return u},$9Ck:function(n,t){var a=n;var r=this.$2nZ;var y=r==="SignedIn";this.$2nZ=a.$Wj;var s=this.get_$vT();if(y!==s)if(s){_js.Trace.logInfo(_a.$0.$I2,"PresenceManager.OnSignInStateChanged: OldSignInState: {0} to NewSignInState: {1}. Requesting presence for every persona active.",r,this.$2nZ);var e=this.$b9;for(var f in e){var c={key:f,value:e[f]};var l=c.key;this.$7NB(l)}}else{_js.Trace.logInfo(_a.$0.$I2,"PresenceManager.OnSignInStateChanged: OldSignInState: {0} to NewSignInState: {1}. Resetting presence to Unknown everywhere.",r,this.$2nZ);var h=this.$b9;for(var o in h)for(var v={key:o,value:h[o]},u=v.value,i=0;i<u.get_$A();i++)u.get_$E(i).set_$I2(0);this.$2W1.$AG3();this.$Fx.$3Vx()}this.$ExL()},$99G:function(n,t){var i=n;var r=null;var e=this.$b9;for(var f in e){var u={key:f,value:e[f]};var s=u.key;var o=u.value;if(o.$5l(i)){r=s;break}}_js.Trace.logInfo(_a.$0.$I2,"PresenceManager.OnImAddressChangedForAPersona: Unregistering persona {0} for old IM Address {1}",i.get_$B6(),r);this.$5dy(i,r);_js.Trace.logInfo(_a.$0.$I2,"PresenceManager.OnImAddressChangedForAPersona: Re-registering persona {0} for new IM Address {1}",i.get_$B6(),$C(i.get_$DF())?"":i.get_$DF());this.$7LZ(i)},$Eww:function(n,t){n in this.$b9||(this.$b9[n]=new(_a.$u.$$(_bc.$mU)));var i=this.$b9[n];if(!i.$5l(t)){i.$F(t);i.get_$A()>1?t.set_$I2(i.get_$E(0).get_$I2()):this.get_$vT()||t.set_$I2(0)}}};_im.$SL=function(n){this.$$d_$Dlp=Function.createDelegate(this,this.$Dlp);this.$$d_$DZJ=Function.createDelegate(this,this.$DZJ);this.$$d_$Df9=Function.createDelegate(this,this.$Df9);this.$1NF=new(_a.$u.$$(String));_im.$SL.initializeBase(this);_a.$4.$z(n,"presenceCrossWindowNotifier");this.$1Wh=n;this.$1NF.add_$22(this.$$d_$Df9);_js.Trace.logInfo(_a.$0.$I2,"PresenceRequestsManager.Ctor")};_im.$SL.prototype={$1Wh:null,$2e7:null,$7TJ:function(n){_a.$4.$1s(n,"sipUri");if(!this.$1NF.$5l(n)){_js.Trace.logInfo(_a.$0.$I2,"PresenceRequestsManager.AddOrUpdatePendingGetRequests: Queuing a presence retrieval request for sip {0}",n);this.$1NF.$F(n)}},$E26:function(n){_a.$4.$1s(n,"sipUri");return this.$1NF.$3M(n)},$AG3:function(){_js.Trace.logInfo(_a.$0.$I2,"PresenceRequestsManager.ClearAll: Clearing all pending get presence requests: {0}",this.$1NF.get_$A());this.$1NF.$1u()},$2A:function(){_js.Trace.logInfo(_a.$0.$I2,"PresenceRequestsManager.InternalDispose.");this.$7Zq()},$7Zq:function(){if(this.$2e7){_js.Trace.logInfo(_a.$0.$I2,"PresenceRequestsManager.CancelBatchGetPresenceRequestsTimer.");this.$2e7=_js.$D.get_$Q().$6Q(this.$2e7)}},$Dlp:function(){this.$2e7=null;var t=this.$1NF.$3Q();var i=t.join("; ");this.$1NF.$1u();var n=new _im.$1HK(t);n.add_$4Q(this.$$d_$DZJ);OwaApplication.$2B.$1V(n)},$Df9:function(n,t){if(this.$1NF.get_$A()>0){if(!this.$2e7){_js.Trace.logInfo(_a.$0.$I2,"PresenceRequestsManager.OnPendingGetPresenceRequestsCollectionChanged: Activating timer to run after {0}ms. Current count of pending requests = {1}",_im.$SL.$7Jt,this.$1NF.get_$A());this.$2e7=_js.$D.get_$Q().$2V(_a.$0.$I2,"GetPresence",this.$$d_$Dlp,_im.$SL.$7Jt)}}else{_js.Trace.logInfo(_a.$0.$I2,"PresenceRequestsManager.OnPendingGetPresenceRequestsCollectionChanged: Cancelling timer. Current count of pending requests = {0}",this.$1NF.get_$A());this.$7Zq()}},$DZJ:function(n){var t=n;var i=t.$1v7.join("; ");if(t.$2H){_js.Trace.logWarning(_a.$0.$I2,"PresenceRequestsManager.OnGetPresenceActionCompleted: Failed with {0} for {1} SipUris: '{2}'",t.$2H,this.$1NF.get_$A(),i);return}}};_im.$1O9=function(n){this.$$d_$DmK=Function.createDelegate(this,this.$DmK);this.$$d_$48H=Function.createDelegate(this,this.$48H);this.$$d_$DlA=Function.createDelegate(this,this.$DlA);this.$n=n;this.$2ah=new(_ff.$18.$$(String));this.$2cw=new(_ff.$18.$$(String));this.$2BI=new(_ff.$18.$$(String))};_im.$1O9.prototype={$n:null,$2ah:null,$2cw:null,$2BI:null,$4Qn:!1,$7UA:function(n){for(var i=new(_ff.$18.$$(String)),f=n.get_$1y(),e=f.length,r=0;r<e;++r){var t=f[r];if(this.$2BI.$5l(t)){this.$2BI.$3M(t);continue}this.$2cw.$5l(t)||this.$2ah.$5l(t)||i.$5l(t)||i.$F(t)}if(i.get_$A()>0){this.$2ah.$3y(i.get_$1y());var u=new _im.$1R9(i.get_$1y());u.add_$2s(this.$$d_$DlA);u.add_$2b(this.$$d_$48H);this.$n.$1V(u)}},$2Vm:function(n){for(var i=0;i<n.get_$A();i++){var t=n.get_$E(i);if(this.$2ah.$5l(t)){this.$2ah.$3M(t);continue}this.$2BI.$5l(t)||this.$2cw.$5l(t)&&this.$2BI.$F(t)}this.$9ns()},$9ns:function(){if(this.$2BI.get_$A()&&!this.$4Qn){this.$4Qn=!0;var t=this.$2BI.get_$E(0);this.$2BI.$5W(0);this.$2cw.$3M(t);var n=new _im.$1TH(t);n.add_$4Q(this.$$d_$DmK);this.$n.$1V(n)}},$DmK:function(n){this.$4Qn=!1;this.$9ns()},$DlA:function(n){for(var f=n,r=f.$1v7,u=r.length,t=0;t<u;++t){var i=r[t];this.$2cw.$5l(i)||this.$2cw.$F(i);this.$2ah.$3M(i)}_js.Trace.logInfo(_a.$0.$6z,"SubscribeForPresenceUpdates: succeeded.")},$48H:function(n){for(var r=n,i=r.$1v7,e=i.length,t=0;t<e;++t){var f=i[t];this.$2ah.$3M(f)}var u=r.$1v7.join(";");_js.Trace.logInfo(_a.$0.$6z,"SubscribeForPresenceUpdates: failed to subscribe for: {0}.",u)}};_im.$oi=function(n,t,i,r,u){_a.$4.$1s(n,"source");_a.$4.$1s(t,"sipUri");this.$2k=n;this.$Sz=t;this.$6u=i;this.$Hg=r;this.$2NM=u};_im.$oi.prototype={$2k:null,$Sz:null,$6u:null,$Hg:0,$2NM:!1,toString:function(){return String.format("Source: {0}, Sip: {1}, DisplayName: {2}, Presence: {3}, IsAboutMeOrMyBuddy: {4}",this.$2k,this.$Sz,$C(this.$6u)?"":this.$6u,this.$Hg,this.$2NM)}};_im.$4h=function(){};_im.$4h.$2LN=function(n){switch(n){case"Away":return 3;case"BeRightBack":return 3;case"Busy":return 4;case"DoNotDisturb":return 6;case"IdleBusy":return 4;case"IdleOnline":return 2;case"None":return 0;case"Offline":return 1;case"Online":return 2;default:return 0}};_im.$4h.$6J0=function(n){switch(n){case 2:return"Online";case 3:return"Away";case 5:return"IdleBusy";case 4:return"Busy";case 6:return"DoNotDisturb";case 1:return"Offline";case 0:default:return"None"}};_im.$4h.$fG=function(n){_a.$4.$1s(n,"imAddress");var t=n.toLowerCase();t.startsWith("sip:")||(t="sip:"+t);return t};_im.$4h.$z2=function(n){_a.$4.$1s(n,"imAddress");var t=n.toLowerCase();t.startsWith("sip:")&&(t=t.substr(4));return t};function IMComponent(){}IMComponent.prototype={$2FV:function(n,t,i){var c=this;n.$r(_im.$Lm).$1I().$t(function(){return new _im.$Lm});var h=this;n.$r(_h.$14A).$1I().$t(function(){return new _im.$1R1(n.$2(_y.$Dp))});var l=this;n.$r(IChatManagerFactory).$1I().$t(function(){var t=i.get_$AA()==="Mouse"&&!_a.$7b.$zF();return new _im.$103(t,n.$2(_im.$Lm),n.$2(_a.$2Y),null,n.$2(_ff.$M),n.$Ts(_g.$2Z),i.get_$Cp())});var v=this;n.$r(_im.$4s).$1I().$t(function(){return n.$2(IChatManagerFactory).$9()});var a=this;n.$r(IChatActionFactory).$1I().$t(function(){var t;t=i.get_$1oh()?new _im.$18i(n.$2(_im.$4s),n.$2(_h.$14A)):new _im.$18i(n.$2(_im.$4s),null);return new _im.$102(t,new _im.$1Ed(n.$2(_im.$4s)))});var s=this;n.$r(_im.$ry).$2a(IChatViewModelFactory).$t(function(){return new _im.$ry(n.$2(_y.$W),n.$2(_rw.$QP),n.$2(_y.$Dp))});if(i.get_$1oh()){var r=this;n.$r(_im.$16m).$2a(IPresenceManager).$1I().$t(function(){return new _im.$16m(n.$2(_im.$4s),n.$2(_im.$Lm),n.$2(_y.$Dp))})}else{var u=this;n.$r(_im.$oh).$2a(IPresenceManager).$1I().$t(function(){return new _im.$oh(n.$2(_im.$4s),n.$2(_im.$Lm),n.$2(_y.$Dp))})}var f=this;n.$r(IChatProviderFactory).$1I().$t(function(){return new _im.$106(i.get_$AA()==="Mouse"&&!_a.$7b.$zF(),n.$2(_im.$4s),n.$36(IPresenceManager),n.$36(IChatActionFactory),i.get_$AA())});var o=this;n.$r(_im.$rx).$1I().$t(function(){return new _im.$rx(i.get_$AA(),n.$2(_g.$O).get_$8OD(),n.$2(_im.$4s),n.$2(_im.$ry))});var e=this;n.$r(ILwxViewModel).$1I().$t(function(){return null})},$Bl5:function(){return[new _a.$4V(_im.$rx,2,1),new _a.$4V(_im.$4s,2,1)]}};_im.$rx=function(n,t,i,r){if(n==="Mouse"&&t){var u=this;i.get_$9zg().add_$22(function(n,t){if(!t.$3R)for(var i=0;i<t.$4C.length;i++){var u=t.$4C[i];r.$9Dt(u)}})}};_im.$Ez=function(n,t,i,r){this.$$d_$4Sn=Function.createDelegate(this,this.$4Sn);this.$$d_$Dey=Function.createDelegate(this,this.$Dey);this.$$d_$5Fo=Function.createDelegate(this,this.$5Fo);_im.$Ez.initializeBase(this);this.$Rt=r;this.$A4=n;this.$LB=new _C(this.$$d_$5Fo,_a.$0.$6z);this.set_$3TB(i.$1CT(1,_bc.$6a.$11g,this.$A4.get_$g6(),1));this.$A4.get_$g6().add_$22(this.$$d_$Dey);t.add_$Xm(this.$$d_$4Sn);if(r.get_mainWindowInstance()&&!r.get_mainWindowInstance().closed){var u=this;_a.$3A.$Nt(r.get_mainWindowInstance(),function(n){n.chatWindowReady(u.$A4.get_$Y())})}};_im.$Ez.prototype={$Rt:null,$A4:null,$LB:null,$W2:null,$6wh:null,get_$3TB:function(){return this.$w(_im.$Ez.$6se)},set_$3TB:function(n){this.$P(_im.$Ez.$6se,n);return n},get_$4DV:function(){return this.$w(_im.$Ez.$746)},set_$4DV:function(n){this.$P(_im.$Ez.$746,n);return n},set_$dp:function(n){this.$6wh=n;this.$4("RawEditorContent");return n},$Dey:function(n,t){switch(t.$3R){case 0:for(var r=0;r<t.$4C.length;r++){var f=t.$4C[r];this.get_$3TB().$317(f)}return;case 2:for(var i=t.$4X.length-1;i>=0;i--){var e=t.$4X[i];var o=this;var u=this.get_$3TB().get_$9T().$HE(function(n){var t=n;return t.$I3.get_$DF()===e.get_$DF()});u<this.get_$3TB().get_$9T().get_$A()&&this.get_$3TB().get_$9T().$5W(u)}return}},$5Fo:function(){if(!_js.$9.$o(this.get_$4DV())){this.$A4.$EeW(this.get_$4DV());var n=this;_a.$3A.$Nt(this.$Rt.get_mainWindowInstance(),function(t){t.sendChatMessage(n.$A4.get_$2O().Id,n.get_$4DV())})}},$4Sn:function(n){_js.Trace.logInfo(_a.$0.$6z,"ChatViewModel.BeforeUnload invoked.");this.$A4.get_$g6().remove_$22(this.$$d_$Dey);var t=this;_a.$3A.$Nt(this.$Rt.get_mainWindowInstance(),function(n){_js.Trace.logInfo(_a.$0.$6z,"ChatViewModel.BeforeUnload calling into main window.");n.endChat(t.$A4.get_$Y())})}};_im.$ry=function(n,t,i){this.$I=n;this.$9M=t;this.$Rt=i};_im.$ry.prototype={$I:null,$9M:null,$Rt:null,$9Dt:function(n){var r={};r.ItemID=n.get_$y();var i=new _y.$Ey;i.set_$6z(n);var t=_bc.$2I.get_$C3T();if(n.$5h8!==-1&&n.$5hD!==-1){t.$5h7=n.$5h8;t.$5hC=n.$5hD}_js.Trace.logInfo(_a.$0.$6z,"ChatViewModelFactory: Chat.BodyText: {0}",n.get_$2eG());var u=this;this.$I.$VL(IChatViewModelFactory,function(){return u},r,t,i,!1)},$wd:function(n,t,i){return null},$1CS:function(n,t,i){var u=n.get_$6z();return new _im.$Ez(u,this.$I,this.$9M,this.$Rt)}};_im.$1R1=function(n){this.$Rt=n};_im.$1R1.prototype={$Rt:null,$9nR:function(n,t,i){for(var f=new Array(n.get_$A()),e=new Array(n.get_$A()),r=0;r<n.get_$A();r++){var u=n.get_$E(r);f[r]=u.get_$26();e[r]=u.get_$DF()}var o=$C(t)?null:t.get_$Y();var s=this;_a.$3A.$Nt(this.$Rt.get_mainWindowInstance(),function(n){n.startChat(f,e,o,i)})}};_im.$Qc=function(n){this.$$d_$48E=Function.createDelegate(this,this.$48E);this.$$d_$Dbo=Function.createDelegate(this,this.$Dbo);this.$$d_$EAI=Function.createDelegate(this,this.$EAI);this.$$d_$AEV=Function.createDelegate(this,this.$AEV);this.$$d_$DpL=Function.createDelegate(this,this.$DpL);_im.$Qc.initializeBase(this,[n]);_im.$Qc.$6Nz++;this.$4dM=".ChatMouseView#Handler."+_im.$Qc.$6Nz};_im.$Qc.prototype={$4dM:null,$4b:null,$NI:null,$39A:null,$A4:null,$Bvl:function(){if(!this.$A4)return null;if(!_js.$9.$o(this.$A4.get_$3o()))return this.$A4.get_$3o();var t=this.$A4.get_$g6();var n=t.get_$A();if(n)if(n===1){var i=t.get_$E(0);return String.format(_nbs.NonBootStrings.l_ChatSubjectOneParticipant_Text,i.get_$26())}else return String.format(_nbs.NonBootStrings.l_ChatSubjectMultipleParticipants_Text,n);else return null},$3T:function(){_js.$7.prototype.$3T.call(this);this.$39A.$3S();this.$4b.$1XL(100);this.$48E(null)},$8j:function(){_js.$F.prototype.$8j.call(this);if(!this.get_$k()){if(this.$A4){this.$A4.get_$g6().remove_$22(this.$$d_$DpL);this.$A4.$1B(_h.$1g.$qH.$3D,this.$$d_$AEV)}this.$A4=null;return}var n=this.get_$k();this.$A4=n.$A4;this.$A4.get_$g6().add_$22(this.$$d_$DpL);this.$A4.$p(_h.$1g.$qH.$3D,this.$$d_$AEV);this.$A4.$p(_h.$1g.$4Dc.$3D,this.$$d_$EAI)},$4T:function(){_js.$7.prototype.$4T.call(this);if(!this.$u){this.$NI.$1B(_b.$4C.$3up.$3D,this.$$d_$Dbo);$(window).unbind(this.$4dM);this.$NI=null;this.$4b=null;this.$39A=null;return}this.$4b=this.$u.$1N("TranscriptScrollRegion");this.$NI=this.$u.$1N("TranscriptLabel");this.$39A=this.$u.$1N("Editor");this.$NI.$p(_b.$4C.$3up.$3D,this.$$d_$Dbo);$(window).bind("resize"+this.$4dM,this.$$d_$48E);this.$7D3();this.$39A.$EaF()},$7D3:function(){var n=this.$Bvl();_js.$9.$o(n)||(window.document.title=n)},$DpL:function(n,t){this.$7D3()},$AEV:function(n,t){this.$7D3()},$EAI:function(n,t){if(this.$A4.get_$4Db()){var i=this.$39A.get_$S().children("textarea");i.length>0&&i[0].setAttribute("disabled","true")}},$Dbo:function(n,t){var i=this.$4b.get_$S();var r=i.prop("scrollHeight");i.scrollTop(r-i.height())},$48E:function(n){var t=$(window).height();t>=425&&this.$4b.get_$S().height(251+t-425)}};_im._TI=function(){};_im._TI.$$cctor=function(){var n="ChatMouseView";new _A(n,function(){_im._TI.$1[n]===undefined&&(_im._TI.$1[n]=[null,[[-1,0,["ParticipantsViewModel"],[_im._TI.$ClK],null,"DataContext",null,_im._TI.$Z,1,null,null,null]],null,[[-1,0,["Chat","BodyText"],[_im._TI.$578,_im._TI.$CiM],null,"Html",null,_im._TI.$Ix,1,null,null,null]],[[-1,0,["Chat","LastMessageAriaLabel"],[_im._TI.$578,_im._TI.$8nK],null,"Text",null,_im._TI.$2pB,1,null,null,null],[-1,0,["Chat","LastMessageAriaLabel"],[_im._TI.$578,_im._TI.$8nK],null,"AriaLabel",null,_im._TI.$1l,1,null,null,null]],[[-1,0,["Chat","Status"],[_im._TI.$578,_im._TI.$CiN],null,"Html",null,_im._TI.$Ix,1,null,null,null]],[[-1,4,null,null,null,"EditorAriaLabel",null,_im._TI.$1pw,0,null,null,null,_u.Strings.l_IM_AT_Textbox_Text],[-1,0,["SendCommand"],[_im._TI.$ClM],null,"EnterCommand",null,_im._TI.$Cej,1,null,null,null],[-1,0,["GetEditorContentCommand"],[_im._TI.$ClJ],_im._TI.$ClO,"GetContentCommand",_im._TI.$2R7,_im._TI.$2R9,2,null,null,null],[-1,0,["SendText"],[_im._TI.$ClN],_im._TI.$ClQ,"Content",_im._TI.$563,_im._TI.$564,2,null,null,null],[-1,0,["RawEditorContent"],[_im._TI.$ClL],_im._TI.$ClP,"RawContent",_im._TI.$Cei,_im._TI.$565,2,null,null,null]]]);var t=_im._TI._hf.childNodes[0].cloneNode(!0);var i=new _z.$CS(_B.$3(t,[0,3]),_js.$2.Instance.$2(_y.$W),_js.$2.Instance.$2(_a.$t),_js.$2.Instance.$2(_ff.$M));i.set_$1zR("_im_8 ms-font-weight-regular ms-font-color-black");i.set_$3IH(!1);i.set_$An2(!0);var o=new _b.$4C(_B.$3(t,[0,2,0]));var s=new _b.$OQ(_B.$3(t,[0,1,1]),_js.$2.Instance.$2(_ff.$M));var r=new _b.$4C(_B.$3(t,[0,1,0]));var f=new _fce.$1F(_B.$3(t,[0,1]),_js.$2.Instance.$2(_js.$p),_js.$2.Instance.$2(_ff.$C),_js.$2.Instance.$2(_ff.$M));var u=new _js.$7(_B.$3(t,[0,0,0,0]));u.set_$6("ReadOnlyRecipientWellView");var e=new _fce.$1F(_B.$3(t,[0,0,0]),_js.$2.Instance.$2(_js.$p),_js.$2.Instance.$2(_ff.$C),_js.$2.Instance.$2(_ff.$M));return new _B(t,[e,u,f,r,s,o,i]).R({TranscriptScrollRegion:f,TranscriptLabel:r,Editor:i})},_im.$Ez,_im.$Qc,!1,!1,!1,0,_im._TI.$1)};_im._TI.$9S=function(){var n=window.document.createElement("DIV");n.innerHTML="<div> <div class='_im_2'> <div class='_im_3 ms-bg-color-neutralLighter'> <div class='_im_4'> <div></div> </div> </div> <div class='_im_5'> <span></span> <div></div> </div> <div class='_im_6 ms-font-weight-regular ms-font-color-neutralSecondary ms-bg-color-neutralLighter ms-border-color-neutralTertiaryAlt'> <span></span> </div> <div class='_im_7 border-color-transparent ms-border-color-neutralTertiaryAlt-hover'></div> </div> </div>";_js.$F.get_$9G().appendChild(n);return n};_im._TI.$ClK=function(n){return n.get_$3TB()};_im._TI.$578=function(n){return n.$A4};_im._TI.$CiM=function(n){return n.get_$2eG()};_im._TI.$8nK=function(n){return n.get_$8ZI()};_im._TI.$CiN=function(n){return n.get_$GZ()};_im._TI.$ClM=function(n){return n.$LB};_im._TI.$ClJ=function(n){return n.$W2};_im._TI.$2R7=function(n){return n.$1T5};_im._TI.$ClN=function(n){return n.get_$4DV()};_im._TI.$563=function(n){return n.get_$DY()};_im._TI.$ClL=function(n){return n.$6wh};_im._TI.$Cei=function(n){return n.get_$mf()};_im._TI.$Z=function(n,t){n.set_$k(t)};_im._TI.$Ix=function(n,t){n.set_$Sa(t)};_im._TI.$2pB=function(n,t){n.set_$1K(t)};_im._TI.$1l=function(n,t){n.set_$4E(t)};_im._TI.$Cej=function(n,t){n.set_$Qn(t)};_im._TI.$ClO=function(n,t){n.$W2=t};_im._TI.$2R9=function(n,t){n.set_$4nF(t)};_im._TI.$ClQ=function(n,t){n.set_$4DV(t)};_im._TI.$564=function(n,t){n.set_$DY(t)};_im._TI.$ClP=function(n,t){n.set_$dp(t)};_im._TI.$565=function(n,t){n.set_$mf(t)};_im._TI.$1pw=function(n,t){n.$2HS=t};_im.$1A6.registerClass("_im.$1A6",_h.$1A3.$$(Number));_im.$102.registerClass("_im.$102",null,IChatActionFactory);_im.$1Ec.registerClass("_im.$1Ec",_h.$1A3.$$(Boolean));_im.$1Ed.registerClass("_im.$1Ed");_im.$1HK.registerClass("_im.$1HK",_h.$1A3.$$(Number));_im.$1JN.registerClass("_im.$1JN",_h.$1A3.$$(Number));_im.$13b.registerClass("_im.$13b",_h.$1A3.$$(Number));_im.$1P0.registerClass("_im.$1P0",_h.$1A3.$$(Number));_im.$1PY.registerClass("_im.$1PY",_h.$1A3.$$(Number));_im.$1QM.registerClass("_im.$1QM",_h.$1A3.$$(Number));_im.$Y0.registerClass("_im.$Y0",_a.$Fj);_im.$18i.registerClass("_im.$18i");_im.$1R9.registerClass("_im.$1R9",_h.$1A3.$$(Number));_im.$1TH.registerClass("_im.$1TH",_h.$1A3.$$(Number));_im.$1CO.registerClass("_im.$1CO");_im.$4s.registerClass("_im.$4s",_js.$Ec,IChatManager,_js.$13p);_im.$103.registerClass("_im.$103",null,IChatManagerFactory);_im.$Lm.registerClass("_im.$Lm",_js.$Ec);_im.$104.registerClass("_im.$104",_js.$Ec);_im.$105.registerClass("_im.$105",null,IChatProvider);_im.$106.registerClass("_im.$106",null,IChatProviderFactory);_im.$oh.registerClass("_im.$oh",_js.$1Ze,IPresenceManager);_im.$16m.registerClass("_im.$16m",_im.$oh);_im.$SL.registerClass("_im.$SL",_js.$1Ze);_im.$1Nz.registerClass("_im.$1Nz",_im.$SL);_im.$1O9.registerClass("_im.$1O9");_im.$oi.registerClass("_im.$oi");_im.$4h.registerClass("_im.$4h");IMComponent.registerClass("IMComponent",null,_a.$1X7);_im.$rx.registerClass("_im.$rx");_im.$Ez.registerClass("_im.$Ez",_a.$En);_im.$ry.registerClass("_im.$ry",null,IChatViewModelFactory,_bc.$1Jj);_im.$1R1.registerClass("_im.$1R1",null,_h.$14A);_im.$Qc.registerClass("_im.$Qc",_js.$7);_im._TI.registerClass("_im._TI");_im.$4s.$2ZK="SignInState";_im.$4s.$4yT="IsSignedIn";_im.$4s.$27x="Presence";_im.$SL.$7Jt=5e3;_im.$Ez.$746=new _H("SendText",String,_im.$Ez,"");_im.$Ez.$6se=new _H("ParticipantsViewModel",_rw.$4c,_im.$Ez);_im.$Qc.$6Nz=0;_im._TI._hf=_im._TI.$9S();_im._TI.$1={};_im._TI.$$cctor();
window.scriptsLoaded['microsoft.exchange.clients.owa2.client.core.im.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['microsoft.exchange.clients.owa2.client.core.im.js'] = (new Date()).getTime(); } catch(e) { window.owaLastErrorReported = e; throw e; }
